<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <title>MX viz</title>
    <style>    #header {
      margin: auto;
      margin-top: 30px;
      width: 95%;
      height: 40px;
      padding: 10px;
      overflow: auto;
      background: rgba(255,255,255,0.06);
    
    }
    
    h2 {
      color: white;
      font-family: "Helvetica Neue", Helvetica, sans-serif;
      margin-top: 5px;
      margin-bottom: 30px;
      font-weight: lighter;
    }
    
    #header h1 {
      margin: auto;
      opacity: 1;
      color: white;
      font-family: "Helvetica Neue", Helvetica, sans-serif;
      font-weight: 300;
      padding-left: 20px;
    
    }
    
    #svgdiv-mx {
      margin: auto;
      padding: 0px 30px;
    }
    
    #svg-mx {
      margin: 0 auto;
      isolation: isolate;
    }
    
    #svg-sadj {
      margin: 0 auto;
    }
    
    #footer {
      position: fixed;
      left: 0;
      bottom: 0;
      margin: auto;
      width: 100%;
      color: white;
      font-family: "Helvetica Neue", Helvetica, sans-serif;
      font-weight: lighter;
      text-align: right;
    }
    
    #options {
      margin: auto;
      padding: 10px;
      padding-top: 20px;
      padding-bottom: 20px;
      width: 95%;
      color:white;
      background: rgba(255,255,255,0.03);
      text-align: center;
      font-family: "Helvetica Neue", Helvetica, sans-serif;
      font-weight: lighter;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      grid-auto-rows: 1fr;
      grid-column-gap: 10px;
    }
    
    #options text{
      padding-left: 20px;
    }
    
    
    
    #svgdiv-sadj {
      margin: auto;
      padding: 0px 30px;
      text-align: center;
      height: 600px;
    }
    
    #svgs-div {
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      grid-auto-rows: 1fr;
      grid-column-gap: 10px;
      width:100%;
      height: 700px;
    
    
    }
    
    
    .inter-layer {
      stroke: rgb(255,255,255);
      stroke-width: 0.5px;
      mix-blend-mode: color-dodge;
      opacity: 0.6;
      fill: none;
    }
    
    .intra-layer {
      stroke: rgb(255,255,255);
      stroke-width: 0.8px;
      mix-blend-mode: color-dodge;
      opacity: 0.8;
      fill: none;
    }
    
    .boxes {
      fill-opacity: 0.1;
      stroke-width: 3;
      mix-blend-mode: lighten;
      stroke-opacity: 0.5;
    }
    
    .nodes_circles {
      /* Something weird is going on with these TODO */
      stroke: none;
      z-index: 1;
    }
    
    .nodes_strokes {
      stroke: white;
      stroke-width: 0.9;
      fill: none;
      mix-blend-mode: lighten;
      z-index: -1;
    }

    .highlights {
      stroke: white;
      fill: none;
      mix-blend-mode: exclusion;
      stroke-width: 1px;
    }
</style>
</head>

<body style="background-color:rgb(1, 7, 9)"5>

  <div id="header">
    <h1> Multilayer network </h1>
  </div>

  <div id="datadiv" data-mxgraph='{
    "directed": false,
    "multigraph": false,
    "graph": {},
    "nodes": [
        {
            "name": "id0",
            "x": 20.918418641167765,
            "y": 20.221762324633396,
            "z": 0.0,
            "L1": 0.0,
            "L2": 0.0,
            "id": 0
        },
        {
            "name": "id1",
            "x": 19.603932337901856,
            "y": 19.74845725268719,
            "z": 0.0,
            "L1": 1.0,
            "L2": 0.0,
            "id": 1
        },
        {
            "name": "id2",
            "x": 20.26987123033988,
            "y": 19.772894832682642,
            "z": 0.0,
            "L1": 2.0,
            "L2": 0.0,
            "id": 2
        },
        {
            "name": "id3",
            "x": 19.36775674393141,
            "y": 19.869744842904144,
            "z": 0.0,
            "L1": 3.0,
            "L2": 0.0,
            "id": 3
        },
        {
            "name": "id4",
            "x": 20.281342147285716,
            "y": 19.343987477268566,
            "z": 0.0,
            "L1": 4.0,
            "L2": 0.0,
            "id": 4
        },
        {
            "name": "id5",
            "x": 20.018864837009037,
            "y": 20.099554937846378,
            "z": 0.0,
            "L1": 5.0,
            "L2": 0.0,
            "id": 5
        },
        {
            "name": "id6",
            "x": 19.313598617932385,
            "y": 19.737593208779447,
            "z": 0.0,
            "L1": 6.0,
            "L2": 0.0,
            "id": 6
        },
        {
            "name": "id7",
            "x": 20.723773560630264,
            "y": 19.776079302092867,
            "z": 0.0,
            "L1": 7.0,
            "L2": 0.0,
            "id": 7
        },
        {
            "name": "id8",
            "x": 19.677586728905325,
            "y": 21.0,
            "z": 0.0,
            "L1": 8.0,
            "L2": 0.0,
            "id": 8
        },
        {
            "name": "id9",
            "x": 19.824855154896362,
            "y": 20.429925821105375,
            "z": 0.0,
            "L1": 9.0,
            "L2": 0.0,
            "id": 9
        },
        {
            "name": "id10",
            "x": 20.918418641167765,
            "y": 20.221762324633396,
            "z": 2.0,
            "L1": 0.0,
            "L2": 1.0,
            "id": 10
        },
        {
            "name": "id11",
            "x": 19.603932337901856,
            "y": 19.74845725268719,
            "z": 2.0,
            "L1": 1.0,
            "L2": 1.0,
            "id": 11
        },
        {
            "name": "id12",
            "x": 20.26987123033988,
            "y": 19.772894832682642,
            "z": 2.0,
            "L1": 2.0,
            "L2": 1.0,
            "id": 12
        },
        {
            "name": "id13",
            "x": 19.36775674393141,
            "y": 19.869744842904144,
            "z": 2.0,
            "L1": 3.0,
            "L2": 1.0,
            "id": 13
        },
        {
            "name": "id14",
            "x": 20.281342147285716,
            "y": 19.343987477268566,
            "z": 2.0,
            "L1": 4.0,
            "L2": 1.0,
            "id": 14
        },
        {
            "name": "id15",
            "x": 20.018864837009037,
            "y": 20.099554937846378,
            "z": 2.0,
            "L1": 5.0,
            "L2": 1.0,
            "id": 15
        },
        {
            "name": "id16",
            "x": 19.313598617932385,
            "y": 19.737593208779447,
            "z": 2.0,
            "L1": 6.0,
            "L2": 1.0,
            "id": 16
        },
        {
            "name": "id17",
            "x": 20.723773560630264,
            "y": 19.776079302092867,
            "z": 2.0,
            "L1": 7.0,
            "L2": 1.0,
            "id": 17
        },
        {
            "name": "id18",
            "x": 19.677586728905325,
            "y": 21.0,
            "z": 2.0,
            "L1": 8.0,
            "L2": 1.0,
            "id": 18
        },
        {
            "name": "id19",
            "x": 19.824855154896362,
            "y": 20.429925821105375,
            "z": 2.0,
            "L1": 9.0,
            "L2": 1.0,
            "id": 19
        },
        {
            "name": "id20",
            "x": 20.918418641167765,
            "y": 20.221762324633396,
            "z": 4.0,
            "L1": 0.0,
            "L2": 2.0,
            "id": 20
        },
        {
            "name": "id21",
            "x": 19.603932337901856,
            "y": 19.74845725268719,
            "z": 4.0,
            "L1": 1.0,
            "L2": 2.0,
            "id": 21
        },
        {
            "name": "id22",
            "x": 20.26987123033988,
            "y": 19.772894832682642,
            "z": 4.0,
            "L1": 2.0,
            "L2": 2.0,
            "id": 22
        },
        {
            "name": "id23",
            "x": 19.36775674393141,
            "y": 19.869744842904144,
            "z": 4.0,
            "L1": 3.0,
            "L2": 2.0,
            "id": 23
        },
        {
            "name": "id24",
            "x": 20.281342147285716,
            "y": 19.343987477268566,
            "z": 4.0,
            "L1": 4.0,
            "L2": 2.0,
            "id": 24
        },
        {
            "name": "id25",
            "x": 20.018864837009037,
            "y": 20.099554937846378,
            "z": 4.0,
            "L1": 5.0,
            "L2": 2.0,
            "id": 25
        },
        {
            "name": "id26",
            "x": 19.313598617932385,
            "y": 19.737593208779447,
            "z": 4.0,
            "L1": 6.0,
            "L2": 2.0,
            "id": 26
        },
        {
            "name": "id27",
            "x": 20.723773560630264,
            "y": 19.776079302092867,
            "z": 4.0,
            "L1": 7.0,
            "L2": 2.0,
            "id": 27
        },
        {
            "name": "id28",
            "x": 19.677586728905325,
            "y": 21.0,
            "z": 4.0,
            "L1": 8.0,
            "L2": 2.0,
            "id": 28
        },
        {
            "name": "id29",
            "x": 19.824855154896362,
            "y": 20.429925821105375,
            "z": 4.0,
            "L1": 9.0,
            "L2": 2.0,
            "id": 29
        }
    ],
    "links": [
        {
            "weight": 2,
            "source": 0,
            "target": 4
        },
        {
            "weight": 2,
            "source": 0,
            "target": 5
        },
        {
            "weight": 2,
            "source": 0,
            "target": 7
        },
        {
            "weight": 1,
            "source": 0,
            "target": 10
        },
        {
            "weight": 1,
            "source": 0,
            "target": 20
        },
        {
            "weight": 2,
            "source": 1,
            "target": 3
        },
        {
            "weight": 2,
            "source": 1,
            "target": 5
        },
        {
            "weight": 2,
            "source": 1,
            "target": 6
        },
        {
            "weight": 1,
            "source": 1,
            "target": 11
        },
        {
            "weight": 1,
            "source": 1,
            "target": 21
        },
        {
            "weight": 2,
            "source": 2,
            "target": 4
        },
        {
            "weight": 2,
            "source": 2,
            "target": 5
        },
        {
            "weight": 2,
            "source": 2,
            "target": 6
        },
        {
            "weight": 2,
            "source": 2,
            "target": 9
        },
        {
            "weight": 1,
            "source": 2,
            "target": 12
        },
        {
            "weight": 1,
            "source": 2,
            "target": 22
        },
        {
            "weight": 2,
            "source": 3,
            "target": 4
        },
        {
            "weight": 2,
            "source": 3,
            "target": 5
        },
        {
            "weight": 2,
            "source": 3,
            "target": 9
        },
        {
            "weight": 1,
            "source": 3,
            "target": 13
        },
        {
            "weight": 1,
            "source": 3,
            "target": 23
        },
        {
            "weight": 2,
            "source": 4,
            "target": 7
        },
        {
            "weight": 1,
            "source": 4,
            "target": 14
        },
        {
            "weight": 1,
            "source": 4,
            "target": 24
        },
        {
            "weight": 2,
            "source": 5,
            "target": 6
        },
        {
            "weight": 2,
            "source": 5,
            "target": 7
        },
        {
            "weight": 2,
            "source": 5,
            "target": 8
        },
        {
            "weight": 2,
            "source": 5,
            "target": 9
        },
        {
            "weight": 1,
            "source": 5,
            "target": 15
        },
        {
            "weight": 1,
            "source": 5,
            "target": 25
        },
        {
            "weight": 2,
            "source": 6,
            "target": 9
        },
        {
            "weight": 1,
            "source": 6,
            "target": 16
        },
        {
            "weight": 1,
            "source": 6,
            "target": 26
        },
        {
            "weight": 2,
            "source": 7,
            "target": 9
        },
        {
            "weight": 1,
            "source": 7,
            "target": 17
        },
        {
            "weight": 1,
            "source": 7,
            "target": 27
        },
        {
            "weight": 2,
            "source": 8,
            "target": 9
        },
        {
            "weight": 1,
            "source": 8,
            "target": 18
        },
        {
            "weight": 1,
            "source": 8,
            "target": 28
        },
        {
            "weight": 1,
            "source": 9,
            "target": 19
        },
        {
            "weight": 1,
            "source": 9,
            "target": 29
        },
        {
            "weight": 2,
            "source": 10,
            "target": 12
        },
        {
            "weight": 2,
            "source": 10,
            "target": 16
        },
        {
            "weight": 2,
            "source": 10,
            "target": 17
        },
        {
            "weight": 2,
            "source": 10,
            "target": 18
        },
        {
            "weight": 1,
            "source": 10,
            "target": 20
        },
        {
            "weight": 2,
            "source": 11,
            "target": 15
        },
        {
            "weight": 2,
            "source": 11,
            "target": 18
        },
        {
            "weight": 2,
            "source": 11,
            "target": 19
        },
        {
            "weight": 1,
            "source": 11,
            "target": 21
        },
        {
            "weight": 2,
            "source": 12,
            "target": 13
        },
        {
            "weight": 2,
            "source": 12,
            "target": 15
        },
        {
            "weight": 2,
            "source": 12,
            "target": 16
        },
        {
            "weight": 2,
            "source": 12,
            "target": 19
        },
        {
            "weight": 1,
            "source": 12,
            "target": 22
        },
        {
            "weight": 2,
            "source": 13,
            "target": 16
        },
        {
            "weight": 1,
            "source": 13,
            "target": 23
        },
        {
            "weight": 2,
            "source": 14,
            "target": 19
        },
        {
            "weight": 1,
            "source": 14,
            "target": 24
        },
        {
            "weight": 2,
            "source": 15,
            "target": 17
        },
        {
            "weight": 2,
            "source": 15,
            "target": 18
        },
        {
            "weight": 2,
            "source": 15,
            "target": 19
        },
        {
            "weight": 1,
            "source": 15,
            "target": 25
        },
        {
            "weight": 2,
            "source": 16,
            "target": 17
        },
        {
            "weight": 2,
            "source": 16,
            "target": 18
        },
        {
            "weight": 2,
            "source": 16,
            "target": 19
        },
        {
            "weight": 1,
            "source": 16,
            "target": 26
        },
        {
            "weight": 2,
            "source": 17,
            "target": 18
        },
        {
            "weight": 1,
            "source": 17,
            "target": 27
        },
        {
            "weight": 2,
            "source": 18,
            "target": 19
        },
        {
            "weight": 1,
            "source": 18,
            "target": 28
        },
        {
            "weight": 1,
            "source": 19,
            "target": 29
        },
        {
            "weight": 2,
            "source": 20,
            "target": 22
        },
        {
            "weight": 2,
            "source": 20,
            "target": 24
        },
        {
            "weight": 2,
            "source": 20,
            "target": 26
        },
        {
            "weight": 2,
            "source": 20,
            "target": 27
        },
        {
            "weight": 2,
            "source": 21,
            "target": 23
        },
        {
            "weight": 2,
            "source": 21,
            "target": 24
        },
        {
            "weight": 2,
            "source": 21,
            "target": 25
        },
        {
            "weight": 2,
            "source": 21,
            "target": 26
        },
        {
            "weight": 2,
            "source": 21,
            "target": 27
        },
        {
            "weight": 2,
            "source": 21,
            "target": 29
        },
        {
            "weight": 2,
            "source": 22,
            "target": 27
        },
        {
            "weight": 2,
            "source": 22,
            "target": 28
        },
        {
            "weight": 2,
            "source": 23,
            "target": 24
        },
        {
            "weight": 2,
            "source": 23,
            "target": 26
        },
        {
            "weight": 2,
            "source": 23,
            "target": 27
        },
        {
            "weight": 2,
            "source": 24,
            "target": 27
        },
        {
            "weight": 2,
            "source": 24,
            "target": 28
        },
        {
            "weight": 2,
            "source": 25,
            "target": 28
        },
        {
            "weight": 2,
            "source": 25,
            "target": 29
        },
        {
            "weight": 2,
            "source": 26,
            "target": 27
        },
        {
            "weight": 2,
            "source": 26,
            "target": 28
        },
        {
            "weight": 2,
            "source": 26,
            "target": 29
        },
        {
            "weight": 2,
            "source": 28,
            "target": 29
        }
    ]
}' style='display:none'></div>


  <div id="svgs-div">


    <div id="svgdiv-mx">
      <svg width="600" height="600" id="svg-mx"></svg>
    </div>




    <div id="svgdiv-sadj">
      <h2>supra-adjacency matrix</h2>
      <svg width="500" height="500" id="svg-sadj"></svg>
    </div>

  </div>

  <div id="options" width=100 height=200>
    
    <div>
    Color nodes by:
    <select id="color-dropdown" title="Node color">
    <option value="L2">Layer</option>
    <option value="L1">L1</option>
    </select>
    </div>


    <div>
    Rotate mx:
    <button type="button" id="rotate-button">Rotate</button>
    </div>

    <div>
    Rotate x:
    <!-- Add a slider -->
    <input type="range" name="x0 Slider" id="slider-x0" min="-20" max="18" value="10">
    </div>


    <div>
    Rotate y:
    <input type="range" name="tilt Slider" id="slider-tilt" min="0" max="900" value="200">
    </div>

  </div>

  <div id="footer">

    <button type="button" id="mx-button">Save mx</button>

    <button type="button" id="sadj-button">Save sadj</button>

  </div>




<!-- Load d3 and other helper scripts -->
<!-- Tip: placing scripts at the bottom of body improves display speed -->
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.6.0/d3.min.js"></script>
<!-- <script type="application/json" src="d3-save-svg-gh-pages/assets/d3-save-svg.min.js"></script> -->
<!-- <script src="https://unpkg.com/d3-3d/build/d3-3d.min.js"></script> -->
<script src="https://d3js.org/d3-color.v1.min.js"></script>

<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script>!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("d3-save-svg",["exports"],t):t(e.d3_save_svg={})}(this,function(e){"use strict";function t(e,t){window.URL=window.URL||window.webkitURL;var n=new Blob(e.source,{type:"text/xml"}),i=window.URL.createObjectURL(n),o=document.body,r=document.createElement("a");o.appendChild(r),r.setAttribute("download",t+".svg"),r.setAttribute("href",i),r.style.display="none",r.click(),r.parentNode.removeChild(r),setTimeout(function(){window.URL.revokeObjectURL(i)},10)}function n(e){function t(e){var t,n,i,r,s=window.getComputedStyle(e),a="";for(t=0,n=s.length;n>t;t++)i=s[t],r=s.getPropertyValue(i),r!==o.getPropertyValue(i)&&"height"!==i&&"width"!==i&&(a+=i+":"+r+";");e.setAttribute("style",a)}function n(e){function t(e){if(e&&e.hasChildNodes())for(var i=e.firstChild;i;)1===i.nodeType&&"SCRIPT"!=i.nodeName&&(n.push(i),t(i)),i=i.nextSibling}var n=[];return n.push(e),t(e),n}var i=window.document.createElementNS(u.svg,"svg");window.document.body.appendChild(i);for(var o=window.getComputedStyle(i),r=n(e),s=r.length;s--;)t(r[s]);i.parentNode.removeChild(i)}function i(e){e.setAttribute("version","1.1"),e.removeAttribute("xmlns"),e.removeAttribute("xlink"),e.hasAttributeNS(u.xmlns,"xmlns")||e.setAttributeNS(u.xmlns,"xmlns",u.svg),e.hasAttributeNS(u.xmlns,"xmlns:xlink")||e.setAttributeNS(u.xmlns,"xmlns:xlink",u.xlink),n(e);var t=new XMLSerializer,i=t.serializeToString(e),o='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',r=e.getBoundingClientRect(),s={top:r.top,left:r.left,width:r.width,height:r.height,"class":e.getAttribute("class"),id:e.getAttribute("id"),childElementCount:e.childElementCount,source:[o+i]};return s}function o(e){for(var t=new Uint8Array(e),n=t.length,i=[];n--;)i[n]=String.fromCharCode(t[n]);var o=window.btoa(i.join(""));return o}function r(e,t){var n,i=new XMLHttpRequest(e);i.open("GET",e,!0),i.responseType="arraybuffer",i.callback=t,i.onload=function(){n=o(this.response),this.callback(null,n)},i.onerror=function(){t("B64 ERROR",null)},i.send()}function s(e){var t=/^\s*data:([a-z]+\/[a-z0-9\-]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i;return!!e.match(t)}function a(e,n){if("svg"!==e.nodeName||1!==e.nodeType)throw"Need an svg element input";var n=n||{},o=i(e,n),r=d(o),s=n.filename||r,o=i(e);t(o,s)}function l(e){var t=e.querySelectorAll("image");[].forEach.call(t,function(e){var t=e.getAttribute("href");s(t)||r(t,function(t,n){e.setAttributeNS(u.xlink,"href","data:image/png;base64,"+n)})})}function d(e){var t="untitled";return e.id?t=e.id:e["class"]?t=e["class"]:window.document.title&&(t=window.document.title.replace(/[^a-z0-9]/gi,"-").toLowerCase()),t}var u={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},w="0.0.2";e.version=w,e.save=a,e.embedRasterImages=l});</script>
<script>// <!-- begin javascript -->
// <!-- <script> -->

    // This file originally modified from https://bl.ocks.org/heybignick/3faf257bbbbc7743bb72310d03b86ee8
    var svgmx= d3.select("#svg-mx"),
        widthmx = +svgmx.attr("width"),
        heightmx = +svgmx.attr("height");
    
    
    svgmx.attr("class", "svg_class")
    
    // Change filename here
    // d3.json("data/mx_2layers2.json", function(error, graph) {
    //   if (error) throw error;
    var graph = JSON.parse(document.getElementById("datadiv").dataset.mxgraph);
    console.log(graph)
    console.log("hello")

    
    
      // need to know how many nodes in layer 1
      // Would be better to get the number of unique values in L1 ...
      var nodes_in_L1 = d3.extent(graph.nodes, function(d) {return d.L1})
    
      var nNodes = nodes_in_L1[1]+1;

      var nNodes_total = d3.extent(graph.nodes, function(d) {return d.id})[1]
    
    
      // Get number of layers
      // Would be better to get the number of unique values in L2.
      var nLayers = d3.extent(graph.nodes, function(d) {return d.L2})[1]+1
    
      // Get coordinates of the first layer of nodes
      x_pos = [];
      y_pos = [];
    
      for (i = 0; i < nNodes; i++) {
        x_pos.push(graph.nodes[i].x);
        y_pos.push(graph.nodes[i].y)
      }
    
      // Define the center of our box
    
      const arrAvg = arr => arr.reduce((a,b) => a + b, 0) / arr.length
      box_center=[arrAvg(x_pos), arrAvg(y_pos)]
    
      // find the max x and y distances from box_center to any point
      var diffsx = [];
      var diffsy = [];
      for (i=0; i < nNodes; i++) {
        diffsx.push(Math.abs(box_center[0] - graph.nodes[i].x))
        diffsy.push(Math.abs(box_center[1] - graph.nodes[i].y))
      }
      box_radiusx = Math.max(...diffsx)
      box_radiusy = Math.max(...diffsy)
    
      var xs = [];
      var ys = [];
      for (i=0; i< nNodes; i++) {
        xs.push(graph.nodes[i].x)
        ys.push(graph.nodes[i].y)
      }
    
      // Set the box buffer
    
      boxspan_x = [Math.min(...xs), Math.max(...xs)]
      boxspan_y = [Math.min(...ys), Math.max(...ys)]
      console.log(boxspan_x,boxspan_y)
    
    
    
      // Projection functions
      var x_0 = 10;
      var y_0 = -5;
      var tilt = 200;
    
    
      function project_x(x_coord, y_coord, z_coord, d_project, x_0, tilt) {
        // x_proj = x_coord*Math.cos(2*Math.PI*(alpha/360)) // cos takes radians
        // first from python to 3d using OP
        x_3d = y_coord;
        z_3d = x_coord + d_project;
    
        // next project from 3d to 2d window
        x_proj = x_0 + (x_3d-x_0)*(d_project/z_3d)
        return x_proj
      }
    
      function project_y(x_coord, y_coord, z_coord, d_project, y_0, tilt) {
        // y_proj = y_coord*Math.sin(2*Math.PI*(alpha/360)) + l_v;
        // first from python to 3d using //
        y_3d = tilt;
        z_3d = x_coord + d_project;
    
        // next project from 3d to 2d
        y_proj = (-1)*(y_0 + (y_3d-y_0)*(d_project/z_3d)) + z_coord
    
        return y_proj
      }
    
      var d_project = 1, l_v = 1
      // Define box path
      function box_path(boxspan_x, boxspan_y, box_buffer, layer, x_0, y_0, d_project, tilt) {
    
        // need to project, then scale the projection
            var z_value = graph.nodes.filter(function(n){return n.L2 == layer;})[0].z
    
    
            const x1p = x_scale(project_x(boxspan_x[0] - box_buffer, boxspan_y[1] + box_buffer, z_value, d_project, x_0, tilt));
            const y1p = y_scale(project_y(boxspan_x[0] - box_buffer, boxspan_y[1] + box_buffer, z_value, d_project, y_0, tilt));
            const x2p = x_scale(project_x(boxspan_x[1] + box_buffer, boxspan_y[1] + box_buffer, z_value, d_project, x_0, tilt));
            const y2p = y_scale(project_y(boxspan_x[1] + box_buffer, boxspan_y[1] + box_buffer, z_value, d_project, y_0, tilt));
            const x3p = x_scale(project_x(boxspan_x[1] + box_buffer, boxspan_y[0] - box_buffer, z_value, d_project, x_0, tilt));
            const y3p = y_scale(project_y(boxspan_x[1] + box_buffer, boxspan_y[0] - box_buffer, z_value, d_project, y_0, tilt));
            const x4p = x_scale(project_x(boxspan_x[0] - box_buffer, boxspan_y[0] - box_buffer, z_value, d_project, x_0, tilt));
            const y4p = y_scale(project_y(boxspan_x[0] - box_buffer, boxspan_y[0] - box_buffer, z_value, d_project, y_0, tilt));
            //
    
            return `M ${x1p},${y1p} L ${x2p},${y2p} L ${x3p} ${y3p} L ${x4p} ${y4p} L ${x1p} ${y1p}`;
          }
    
    // Define necessary functions for nodes
    
    
      var node_radius = 6;
    
      if (nLayers < 5) {
    
        var y_scale = d3.scaleLinear()
          .range([50 + 30*(5-nLayers), heightmx-50 - 30*(5-nLayers)])
    
    
      } else {
    
        var y_scale = d3.scaleLinear()
          .range([50, heightmx-50])
      }
    
      y_scale.domain(d3.extent(graph.nodes, function(d) {return project_y(d.x, d.y, d.z, d_project, y_0, tilt); }));
    
    
      var x_scale = d3.scaleLinear()
        .range([150, widthmx-150])
    
    
      var box_buffer = 0.2;
      var nodes_extent = d3.extent(graph.nodes, function(d) {return project_x(d.x, d.y, d.z, d_project, x_0, tilt); });
      var extent_buffer = 0.01 
      x_scale.domain([nodes_extent[0] - extent_buffer, nodes_extent[1] + extent_buffer]);
      console.log([nodes_extent[0] - extent_buffer, nodes_extent[1]])
      // need to define extent first then subtract cause im not projecting rn
    
      console.log(d3.extent(graph.nodes, function(d) {return project_x(d.x, d.y, d.z, d_project, x_0, tilt); }))
    
      var node_colors = ["#58c3be","#7dbf6d","#d95f02", "#cc0062","#6f08a5"];
    
      if (nLayers < 6) {
        var node_colormap = d3.scaleOrdinal(node_colors).domain(d3.extent(graph.nodes, function(d) {return d.L2}));
        console.log(node_colormap(0))
        console.log(node_colormap(1))
        console.log(node_colormap(2))
        console.log(node_colormap(3))
        console.log(node_colormap(4))
        console.log(node_colors)
      } else {
        var node_colormap = d3.scaleOrdinal(d3.schemeAccent).domain(d3.extent(graph.nodes, function(d) {return d.L2}));
      }
      
      // var L1_colormap = d3.scaleOrdinal(d3.schemeAccent).domain(d3.extent(graph.nodes, function(d) {return d.L1}));
      var L1_colormap = d3.scaleSequential(d3.interpolateSpectral).domain(d3.extent(graph.nodes, function(d) {return d.L1}));
    
    
      // d3.select("#color-dropdown").text("first");
    
      // layer_data = Object.getOwnPropertyNames(graph.nodes[0])
      // d3.select("#color-dropdown").selectAll("option")
      //   .data(layer_data)
      //   .enter()
      //     .append("option")
      //       .attr("value", function(d) {return d})
      //       .text(function(d) {return d});
    
      d3.select("select")
        .on("change",function(d){
          var selected = d3.select("#color-dropdown").node().value;
          // color = {
          //   return d => color_scale();
          // }
    
          if (selected == "L1"){
            node.selectAll("circle")
              .attr("fill",function(d) {return L1_colormap(d[selected])})
              .style("mix-blend-mode", "none")
    
            d3.selectAll(".boxes")
              .attr("fill", "white")
              .attr("stroke", "white")
              .style("fill-opacity", 0.04)
              .style("stroke-opacity", 0.2)
    
            
          }
    
          if (selected == "L2"){
            node.selectAll("circle")
              .attr("fill", function(d) {return node_colormap(d[selected])});
    
            for (i=nLayers-1; i>-1; i--) {
              d3.selectAll(`#box${i}`)
                .attr("fill", function(d) {return node_colormap(graph.nodes.filter(function(n){return n.L2 == i;})[0].L2)})
                .attr("stroke", function(d) {return node_colormap(graph.nodes.filter(function(n){return n.L2 == i;})[0].L2)})
                .style("fill-opacity", 0.1)
                .style("stroke-opacity", 0.5)
            }
    
          }
          // console.log(d3.scaleLinear(graph.nodes[selected]));
        })
    
    // functions and info for edges
      function edge_line(d, x_0, y_0, d_project, tilt) {
            const source_node = graph.nodes.filter(function(n){return n.id == d.source;})[0]
            const target_node = graph.nodes.filter(function(n){return n.id == d.target;})[0]
            const y1 = y_scale(project_y(source_node.x, source_node.y, source_node.z, d_project, y_0, tilt));
            const x1 = x_scale(project_x(source_node.x, source_node.y, source_node.z, d_project, x_0, tilt));
            const y2 = y_scale(project_y(target_node.x, target_node.y, target_node.z, d_project, y_0, tilt));
            const x2 = x_scale(project_x(target_node.x, target_node.y, target_node.z, d_project, x_0, tilt));
    
    
            return `M ${x1},${y1} L ${x2},${y2}`;
          }
    
      function edge_class(d) {
        // Determine within layer or between layer edges
        node_source_L2 = graph.nodes.filter(function(n){return n.id == d.source;})[0].L2
        node_target_L2 = graph.nodes.filter(function(n){return n.id == d.target;})[0].L2
    
        if (node_source_L2 == node_target_L2) {
          edge_class_id = "intra-layer"
        } else {
          edge_class_id = "inter-layer"
        }
    
        return edge_class_id
      }
    
    
      // Draw!!
    
      var boxes = svgmx.append("g")
    
    
      // Can create an array of layers and then attach that data instead
      // of using a for loop
      for (i=nLayers-1; i>-1; i--) {
        boxes.append("path")
          .attr("d",box_path(boxspan_x, boxspan_y, box_buffer, i, x_0, y_0, d_project, tilt))
          .attr("class", "boxes")
          .attr("id", `box${i}`)
          .attr("fill", function(d) {return node_colormap(graph.nodes.filter(function(n){return n.L2 == i;})[0].L2)})
          .attr("stroke", function(d) {return node_colormap(graph.nodes.filter(function(n){return n.L2 == i;})[0].L2)})
        }
    
    
      var link = svgmx.append("g")
        .selectAll("line")
        .data(graph.links)
        .enter().append("path")
          .attr("d", function(d) {return edge_line(d,x_0, y_0, d_project, tilt)})
          .attr("class", edge_class);
    
    
    
    
      var node = svgmx.append("g")
        .attr("class","nodes")
        .selectAll("g")
        .data(graph.nodes)
        .enter().append("g")
        .on("mouseover", mouseover)
        .on("mouseout", mouseout)
    
    
      node.append("circle")
        .attr("r", node_radius)
        .attr("cx", function(d) {return x_scale(project_x(d.x, d.y, d.z, d_project, x_0, tilt))})
        .attr("cy", function(d) {return y_scale(project_y(d.x, d.y, d.z, d_project, y_0, tilt))})
        .attr("fill", function(d) {console.log(d.L2); return node_colormap(d.L2)})
        .attr("class", "nodes_circles")
        .attr("id", function(d) {return d.id})
    
      node.append("circle")
        .attr("r", node_radius)
        .attr("cx", function(d) {return x_scale(project_x(d.x, d.y, d.z, d_project, x_0, tilt))})
        .attr("cy", function(d) {return y_scale(project_y(d.x, d.y, d.z, d_project, y_0, tilt))})
        .attr("class", "nodes_strokes")
        .attr("id", function(d) {return d.id})
    
    
    
    
    
    
    
    // buttons!
      d3.select('#mx-button').on('click', function() {
        var config = {
          filename: 'mx',
        }
        d3_save_svg.save(d3.select('#svg-mx').node(), config);

        // DOM.download(() => serialize(d3.select('#svg-mx')), "test", "Save as SVG")
      });
    
      d3.select('#sadj-button').on('click', function() {
        var config = {
          filename: 'sadj',
        }
        d3_save_svg.save(d3.select('#svg-sadj').node(), config);
      });
    
    
      var angle = 0;
      d3.select("#rotate-button").on("click", function() {
    
        angle += 90
        d3.select("#svg-mx")
          .style("transform", "rotate(" + angle + "deg)");
      })
    
      // Slider functions
      function changex0(selectedValuex, selectedValuey, selected_value_d, selected_tilt) {
        x_0 = Number(selectedValuex);
        y_0 = Number(selectedValuey);
        d_project = Number(selected_value_d);
        tilt = Number(selected_tilt);

        console.log(x_0,y_0,d_project,tilt)
    
        // Need to recalculate the x_scale domain each time
        extent_buffer = 0.01
        // x_scale.domain(d3.extent(graph.nodes, function(d) {return project_x(d.x, d.y, d.z, d_project, x_0, tilt); }));
        var nodes_extent1 = d3.extent(graph.nodes, function(d) {return project_x(d.x, d.y, d.z, d_project, x_0, tilt)});
        x_scale.domain([nodes_extent1[0] - extent_buffer, nodes_extent1[1] + extent_buffer]);
    
    
        // And y scale
        y_scale.domain(d3.extent(graph.nodes, function(d) {return project_y(d.x, d.y, d.z, d_project, y_0, tilt); }));
    
        // Recalculate node position
        d3.selectAll(".nodes_circles")
          .attr("cx", function(d) {return x_scale(project_x(d.x, d.y, d.z, d_project, x_0, tilt))})
          .attr("cy", function(d) {return y_scale(project_y(d.x, d.y, d.z, d_project, y_0, tilt))})
    
        d3.selectAll(".nodes_strokes")
          .attr("cx", function(d) {return x_scale(project_x(d.x, d.y, d.z, d_project, x_0, tilt))})
          .attr("cy", function(d) {return y_scale(project_y(d.x, d.y, d.z, d_project, y_0, tilt))})
    
        // Recalculate edge postitions
        d3.selectAll(".intra-layer")
          .attr("d", function(d) {return edge_line(d,x_0, y_0, d_project, tilt)});
    
        d3.selectAll(".inter-layer")
          .attr("d", function(d) {return edge_line(d,x_0, y_0, d_project, tilt)});
    
        // Recalculate box postitions
        for (i=nLayers-1; i>-1; i--) {
          d3.selectAll(`#box${i}`)
            .attr("d",function(d) {return box_path(boxspan_x, boxspan_y, box_buffer, i, x_0, y_0, d_project, tilt)})
            // .attr("fill", function(d) {return node_colormap(graph.nodes.filter(function(n){return n.L2 == i;})[0].L2)})
            // .attr("stroke", function(d) { return node_colormap(graph.nodes.filter(function(n){return n.L2 == i;})[0].L2)})
        }
    
    
    
    
      }
    
      // Listen to the slider
      d3.select("#slider-x0").on("input", function(d){
        selectedValue = this.value
        x_0 = this.value
        changex0(x_0, y_0, d_project, tilt)
    
      })
    
    
      d3.select("#slider-tilt").on("input", function(d){
        //   selectedValue = this.value
        tilt = this.value
        changex0(x_0,y_0,d_project,tilt)
      })
    
    
    
    
      // Plotting the supra-adjacency matrix
        //
        function get_source_node(d) {
          source_node = graph.nodes.filter(function(n){return n.id == d.source;})[0];
          return source_node
        }
    
        function get_target_node(d) {
          target_node = graph.nodes.filter(function(n){return n.id == d.target;})[0];
          return target_node
        }
        //
        // // Edge weight colormap
        //
        var edge_colormap = d3.scaleSequential(d3.interpolateGreys).domain([d3.extent(graph.links, function(d) {return d.weight})[1], 0]);
        console.log([0, d3.extent(graph.links, function(d) {return d.weight})[1]])
        //
        var svgsadj= d3.select("#svg-sadj"),
            widthsadj = +svgsadj.attr("width"),
            heightsadj = +svgsadj.attr("height");
    
        svgsadj.attr("class", "svg_class")
    
        var y_scale2 = d3.scaleLinear()
          .range([20, heightsadj-20])
    
        y_scale2.domain(d3.extent(graph.nodes, function(d) {return d.id; }));
    
        var x_scale2 = d3.scaleLinear()
          .range([20, widthsadj-20]);
        x_scale2.domain(d3.extent(graph.nodes, function(d) {return d.id; }))
    
        var rect_r = (widthsadj-40)/graph.nodes.length;
    
    
        // draw box for heatmap
        svgsadj.append("rect")
          .attr("x", 20)
          .attr("y", 20)
          .attr("height", heightsadj-40 + rect_r)
          .attr("width", widthsadj-40+ rect_r)
          .style("stroke", "white")
          .style("stroke-width", 0.25)
    
    
    
    
        var boxes_lower = svgsadj.append("g")
          .selectAll("rect")
          .data(graph.links)
          .enter().append("rect")
            .attr("x", function(d) {return x_scale2(get_source_node(d).id)})
            .attr("y", function(d) {return y_scale2(get_target_node(d).id)})
            .style("fill", function(d) {return edge_colormap(d.weight)})
            .attr("height", rect_r)
            .attr("width", rect_r)
            .attr("class", "heatmap")
    
        var boxes_upper = svgsadj.append("g")
          .selectAll("rect")
          .data(graph.links)
          .enter().append("rect")
            .attr("x", function(d) {return x_scale2(get_target_node(d).id)})
            .attr("y", function(d) {return y_scale2(get_source_node(d).id)})
            .style("fill", function(d) {return edge_colormap(d.weight)})
            .attr("height", rect_r)
            .attr("width", rect_r)
            .attr("class", "heatmap")
    
    
    
        var lines_lower = svgsadj.append("g")
          .selectAll("line")
          .data(graph.nodes)
          .enter().append("line")
            .attr("x1", function(d) {return x_scale2(d.id)})
            .attr("y1", 5)
            .attr("x2", function(d) {return x_scale2(d.id)+rect_r})
            .attr("y2", 5)
            .style("stroke", function(d) {return node_colormap(d.L2)})
            .style("stroke-width", 8)
    
        var lines_upper = svgsadj.append("g")
          .selectAll("line")
          .data(graph.nodes)
          .enter().append("line")
            .attr("x1", 5)
            .attr("y1", function(d) {return y_scale2(d.id)})
            .attr("x2", 5)
            .attr("y2", function(d) {return y_scale2(d.id)+rect_r})
            .style("stroke", function(d) {return node_colormap(d.L2)})
            .style("stroke-width", 8)

        var col_highlight = svgsadj.append("rect")
          .attr("x",function() {return x_scale2(0)})
          .attr("y",function() {return y_scale2(0)})
          .attr("width", rect_r-1)
          .attr("height", y_scale2.range()[1] - y_scale2.range()[0] + rect_r)
          .style("opacity", 0)
          .attr("class", "highlights")

        var row_highlight = svgsadj.append("rect")
          .attr("x", function() {return x_scale2(0)})
          .attr("y", function() {return y_scale2(0)})
          .attr("width", x_scale2.range()[1] - x_scale2.range()[0] + rect_r)
          .attr("height", rect_r-1)
          .style("opacity", 0)
          .attr("class", "highlights")


        // Mouseover and Mouseouts
        function mouseover() {
          d3.select(this).selectAll("circle").transition()
            .duration(100)
            .attr("r",node_radius*2)

          // Perhaps highlight any edges from this node?

          // Now highlight on the adj matrix

          var selected_node_id = d3.select(this).select("circle").attr("id");
          console.log(selected_node_id)

          // Move col_highlight to appropriate spot and then show it!
          col_highlight
            .attr("x", function() {return x_scale2(selected_node_id)})
            .style("opacity", 1);

          row_highlight
            .attr("y", function() {return y_scale2(selected_node_id)})
            .style("opacity", 1);



        }

        function mouseout() {
          d3.select(this).selectAll("circle").transition()
            .duration(100)
            .attr("r",node_radius)

          col_highlight
            .style("opacity", 0);

          row_highlight
            .style("opacity", 0);
        }
    
    
    
    
    
    
    
    // });
    
    </script>


</body>